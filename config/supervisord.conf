[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:tailscaled]
command=/usr/sbin/tailscaled --state=/var/lib/tailscale/tailscaled.state --socket=/var/run/tailscale/tailscaled.sock
autostart=%(ENV_TAILSCALE_ENABLED)s
autorestart=true
priority=5
startsecs=3
stdout_logfile=/var/log/supervisor/tailscaled.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/tailscaled-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:tailscale-connect]
command=/usr/local/bin/tailscale-connect.sh
autostart=%(ENV_TAILSCALE_ENABLED)s
autorestart=false
priority=10
startsecs=0
stdout_logfile=/var/log/supervisor/tailscale-connect.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/var/log/supervisor/tailscale-connect-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
environment=TAILSCALE_ENABLED="%(ENV_TAILSCALE_ENABLED)s",TAILSCALE_AUTHKEY="%(ENV_TAILSCALE_AUTHKEY)s",TAILSCALE_HOSTNAME="%(ENV_TAILSCALE_HOSTNAME)s",TAILSCALE_ADVERTISE_ROUTES="%(ENV_TAILSCALE_ADVERTISE_ROUTES)s",HYTALE_PORT="%(ENV_HYTALE_PORT)s"

[program:dashboard]
command=/opt/hytale-dashboard/.venv/bin/uvicorn app:app --host 0.0.0.0 --port %(ENV_DASHBOARD_PORT)s
directory=/opt/hytale-dashboard
user=hytale
autostart=true
autorestart=true
startsecs=5
startretries=3
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=HYTALE_DIR="%(ENV_HYTALE_DIR)s",HYTALE_PORT="%(ENV_HYTALE_PORT)s",DASH_USER="%(ENV_DASH_USER)s",DASH_PASS="%(ENV_DASH_PASS)s",ALLOW_CONTROL="%(ENV_ALLOW_CONTROL)s",CF_API_KEY="%(ENV_CF_API_KEY)s",TAILSCALE_ENABLED="%(ENV_TAILSCALE_ENABLED)s"

[program:hytale-server]
command=/usr/local/bin/hytale-server-wrapper.sh
directory=/opt/hytale-server
user=hytale
autostart=false
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=60
stopsignal=INT
stdout_logfile=/opt/hytale-server/logs/wrapper.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/opt/hytale-server/logs/wrapper-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0770
chown=root:hytale

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
