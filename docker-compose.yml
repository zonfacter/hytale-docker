#===============================================================================
# Hytale Server + Dashboard - Docker Compose
# https://github.com/zonfacter/hytale-docker
#
# Schnellstart / Quick Start:
#   docker-compose up -d
#
# Dashboard öffnen / Open Dashboard:
#   http://localhost:8088
#
#===============================================================================
# WICHTIG / IMPORTANT: Volume Configuration
#===============================================================================
# Diese Konfiguration verwendet standardmäßig benannte Volumes (named volumes).
# Dies ist die empfohlene Methode für Produktionssysteme, da sie:
# - Unabhängig vom Arbeitsverzeichnis sind
# - Besser von Docker verwaltet werden
# - Konsistent über verschiedene Betriebssysteme hinweg funktionieren
#
# This configuration uses named volumes by default. This is the recommended
# method for production systems because they:
# - Are independent of the working directory
# - Are better managed by Docker
# - Work consistently across different operating systems
#
# Alternative Optionen / Alternative options:
# 1. Bind Mounts mit relativen Pfaden - siehe Zeile 106
#    Bind mounts with relative paths - see line 106
# 2. Bind Mounts mit absoluten Pfaden - siehe Zeile 116
#    Bind mounts with absolute paths - see line 116
#===============================================================================

services:
  hytale:
    image: zonfacter/hytale-docker:latest
    container_name: hytale-server
    build:
      context: .
      dockerfile: Dockerfile
      # Build arguments for customization (optional)
      # Uncomment and modify to use different base images or Java versions
      # args:
      #   DEBIAN_BASE_IMAGE: debian:bookworm-slim
      #   DEBIAN_CODENAME: bookworm
      #   JAVA_VERSION: 21

    # Ports
    ports:
      # Dashboard Web-Interface
      - "8088:8088/tcp"
      # Hytale Game Server
      - "5520:5520/udp"
      # Nitrado WebServer API (for plugins)
      - "5523:5523/tcp"

    # Environment Variables
    environment:
      # Server Settings
      - HYTALE_MEMORY_MIN=2G
      - HYTALE_MEMORY_MAX=4G

      # Downloader Settings
      # Optional: Provide URL to automatically download the Hytale downloader
      # If not set, you must manually copy the downloader to ./data/downloader/
      # Example: - HYTALE_DOWNLOADER_URL=https://your-server.com/hytale-downloader-linux-amd64
      - HYTALE_DOWNLOADER_URL=

      # Dashboard Settings
      - DASH_USER=admin
      - DASH_PASS=changeme          # CHANGE THIS!
      - ALLOW_CONTROL=true

      # Optional: CurseForge API Key for mod downloads
      # Get your free key at: https://console.curseforge.com/
      - CF_API_KEY=

      # User/Group IDs (for file permissions)
      - PUID=1000
      - PGID=1000

      # Timezone
      - TZ=Europe/Berlin

    # Persistent Data Volumes
    # Using named volumes (recommended for production and portability)
    volumes:
      # Game world data (players, buildings, etc.)
      - hytale-universe:/opt/hytale-server/universe

      # Installed mods
      - hytale-mods:/opt/hytale-server/mods

      # Backup files
      - hytale-backups:/opt/hytale-server/backups

      # Downloader & credentials (for OAuth)
      - hytale-downloader:/opt/hytale-server/.downloader

      # Logs (optional)
      - hytale-logs:/opt/hytale-server/logs

    # Alternative: Bind mounts with relative paths
    # Use this if you need direct host file system access (e.g., for backups or config editing)
    # IMPORTANT: Must run docker-compose from the repository root directory
    # For production, consider using absolute paths instead
    # volumes:
    #   - ./data/universe:/opt/hytale-server/universe
    #   - ./data/mods:/opt/hytale-server/mods
    #   - ./data/backups:/opt/hytale-server/backups
    #   - ./data/downloader:/opt/hytale-server/.downloader
    #   - ./data/config.json:/opt/hytale-server/config.json
    #   - ./data/logs:/opt/hytale-server/logs

    # Alternative: Bind mounts with absolute paths (most reliable for production)
    # Replace /path/to/hytale-data with your actual data directory path
    # volumes:
    #   - /path/to/hytale-data/universe:/opt/hytale-server/universe
    #   - /path/to/hytale-data/mods:/opt/hytale-server/mods
    #   - /path/to/hytale-data/backups:/opt/hytale-server/backups
    #   - /path/to/hytale-data/downloader:/opt/hytale-server/.downloader
    #   - /path/to/hytale-data/config.json:/opt/hytale-server/config.json
    #   - /path/to/hytale-data/logs:/opt/hytale-server/logs

    # Restart Policy
    restart: unless-stopped

    # Resource Limits (optional, adjust as needed)
    # deploy:
    #   resources:
    #     limits:
    #       memory: 6G
    #     reservations:
    #       memory: 4G

    # Stop gracefully (SIGINT for proper save)
    stop_signal: SIGINT
    stop_grace_period: 60s

#===============================================================================
# Named Volumes Definition
#===============================================================================
volumes:
  hytale-universe:
    driver: local
  hytale-mods:
    driver: local
  hytale-backups:
    driver: local
  hytale-downloader:
    driver: local
  hytale-logs:
    driver: local
